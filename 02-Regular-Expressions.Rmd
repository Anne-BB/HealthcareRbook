# Regular Expressions

Here is a short tutorial on regular expression. We will begin using base R. This section is based on experience trying to clean a data frame containing many words used to describe one disease or one drug.
```{r base-R-example}
#create example dataframe
df<-data.frame(
  drug=c("valium 1mg","verapamil sr","betaloc zoc","tramadol","valium (diazepam)"),
  infection=c("pneumonia","aspiration pneumonia","tracheobronchitis","respiratory tract infection","respiratory.tract.infection"))
```

Now that we have a data frame, we can use pattern matching to replace part of phrase. This step can be done simply using _gsub_ command. First create a list so that the computer searches the phrases in the list.

## base R
```{r gsub-example}
#create list to remove phrase
redun=c("1mg", "zoc", "sr")
pat=paste0("\\b(",paste0(redun,collapse = "|"),")\\b")
df$drug1<-gsub(pat,"",df$drug)
df$drug1

#create list to remove phrase
redunc1=c("respiratory tract infection", "tracheobronchitis", "aspiration")
pat=paste0("\\b(",paste0(redunc1,collapse = "|"),")\\b")
df$infection1<-gsub(pat,"",df$infection)
df$infection1
```

This section deals with meta-characterers. Examples of meta-characters include $ . + * ? ^ () {} []. These meta-characters requires the double back slashes \\.

```{r metacharacter}
#create list to remove phrase
redun=c("1mg", "zoc", "sr")
#redun1=c("\\(|\\)")
pat=paste0("\\b(",paste0(redun,collapse = "|"),")\\b")
df$drug2<-gsub(pat,"",df$drug)
#pat=paste0("\\b(",paste0(redun1,collapse = "|"),")\\b")

#[a-z] indicates any letter
#[a-z]+ indicates any letter and those that follow the intial letter
df$drug2<-gsub("\\(|[a-z]+\\)","",df$drug2)
df$drug2

#
redunc=c("\\.")
redunc1=c("respiratory tract infection", "tracheobronchitis", "aspiration")
pat=paste0("\\b(",paste0(redunc,collapse = "|"),")\\b")
df$infection2<-gsub(pat," ",df$infection)
pat=paste0("\\b(",paste0(redunc1,collapse = "|"),")\\b")
df$infection2<-gsub(pat," ",df$infection2)

df$infection2

```

##removing phrase within bracket is different
```{r metacharacter2}
redun=c("1mg", "zoc", "sr","\\(\\)")
pat=paste0("\\b(",paste0(redun,collapse = "|"),")\\b")
df$drug2<-gsub(pat,"",df$drug)
df$drug2
```
## stringr

The following example is taken from pdf containing data on stroke prevalence in each country. Some of the errors were introduced in the conversion from pdf to excel. 
```{r pdf to excel}
library(stringr)

#error introduced by double space ie china
a<-c("8396 (7890 to 8920)","6 301 113(6 085 757 to 6 517 308)","4 841 208 (4 533 619 to 5 141 654)","1 407 701 (127 445 922 to 138 273 863)","4 841 208\n(4 533 619 to\n5 141 654)")

b<-str_replace (a, "\\(c.*\\)","")

#this is a complex example to clean and requires several steps. Note that the original data in the list a is now assigned to b. 
b<-str_replace(a,"\n","") %>% 
  str_replace("\\(.*","") %>%
  str_replace("\n.*","") %>%
  str_replace("\\)","") %>%
str_replace("\\s","") %>%
  str_replace("\\s","")%>% as.numeric()

```